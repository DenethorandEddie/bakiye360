---
description: 
globs: 
alwaysApply: true
---
1. Freemium / Temel Plan SÄ±nÄ±rlamalarÄ±
ğŸ“Š Veri SÄ±nÄ±rlamalarÄ±
Ä°ÅŸlem Limiti: Ãœcretsiz hesaplar aylÄ±k 30 iÅŸlem girebilsin (gelir/gider)
Kategori SÄ±nÄ±rÄ±: Maksimum 7 ana kiÅŸiselleÅŸtirilebilir kategori
GeÃ§miÅŸ Veri: Sadece son 3 aylÄ±k veri gÃ¶rÃ¼ntÃ¼lenebilir
BÃ¼tÃ§e Hedefleri: 1 aktif bÃ¼tÃ§e hedefi oluÅŸturabilme
Abonelik: 1 tane abonelik oluÅŸturabilmek

Premium modelde bÃ¼tÃ¼n Ã¶zellikler aÃ§Ä±k ve sÄ±nÄ±rsÄ±z olacak. HiÃ§ bir engelleme olmayacak.

1.2. KullanÄ±cÄ± YapÄ±sÄ±nÄ±n HazÄ±rlanmasÄ±
Supabase iÃ§erisinde kullanÄ±lacak.
Mevcut YapÄ± Analizi
user_settings tablosunda zaten ÅŸu kullanÄ±ÅŸlÄ± alanlar var:
subscription_start_date (timestamp): AboneliÄŸin baÅŸlangÄ±Ã§ tarihini tutmak iÃ§in
subscription_end_date (timestamp): AboneliÄŸin bitiÅŸ tarihini takip etmek iÃ§in
stripe_customer_id (varchar): Stripe'daki mÃ¼ÅŸteri ID'sini depolamak iÃ§in
stripe_subscription_id (varchar): Stripe'daki abonelik ID'sini kaydetmek iÃ§in
app_preferences (jsonb): JSON formatÄ±nda kullanÄ±cÄ± tercihlerini saklayabilen bir alan
Ä°htiyaÃ§ Tespiti
Mevcut tablo yapÄ±nÄ±zda ek tablo oluÅŸturmaya gerek yok, user_settings tablosu yeterli olacaktÄ±r
Eksik olduÄŸunu dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼m tek alan bir subscription_status alanÄ± olabilir (aktif, iptal edilmiÅŸ, askÄ±ya alÄ±nmÄ±ÅŸ gibi durumlarÄ± izlemek iÃ§in)
Supabase Row Level Security (RLS) politikalarÄ±nÄ±zÄ±n premium iÃ§erik eriÅŸimini kontrol edecek ÅŸekilde gÃ¼ncellenmesi gerekecek
Ã–nerilen Ä°yileÅŸtirmeler
user_settings tablosuna subscription_tier veya subscription_plan alanÄ± eklenebilir (free, premium, pro gibi deÄŸerler iÃ§in)
app_preferences JSON alanÄ±nÄ± premium Ã¶zellikleri etkinleÅŸtirmek/devre dÄ±ÅŸÄ± bÄ±rakmak iÃ§in kullanabilirsiniz
Ä°steÄŸe baÄŸlÄ± olarak, payment_history veya benzeri bir JSON alanÄ± ekleyerek Ã¶deme geÃ§miÅŸi Ã¶zetini saklayabilirsiniz
Veri Modelleme YaklaÅŸÄ±mÄ±
Yeni bir tablo eklemek yerine, mevcut user_settings tablosunu ve iliÅŸkili tablolarÄ± kullanacak bir veri modelleme yaklaÅŸÄ±mÄ± izlenecektir:
KullanÄ±cÄ±larÄ±n premium durumunu subscription_end_date > current_timestamp sorgusu ile hÄ±zlÄ±ca kontrol edebilirsiniz
Yetkili eriÅŸim kontrolleri iÃ§in middleware'de bu kontrolÃ¼ kullanabilirsiniz
Stripe webhook'larÄ± ile gelen abonelik durum gÃ¼ncellemelerini doÄŸrudan bu tabloya yansÄ±tabilirsiniz
Bu yaklaÅŸÄ±m, ekstra tablo oluÅŸturmadan ve mevcut yapÄ±nÄ±zÄ± bozmadan premium Ã¼yelik sistemini entegre etmenize olanak saÄŸlayacaktÄ±r.

2. Stripe ÃœrÃ¼n ve Fiyat AyarlarÄ±nÄ±n YapÄ±lmasÄ±
ÃœrÃ¼n AdÄ±: "Bakiye360 Premium"
Sadece aylÄ±k abonelik var ve fiyat: TL149.99 TRY
Fiyat ID: price_1QzYZMGUPk4i0W9usDIbLXan (.env dosyasÄ± iÃ§erisinde NEXT_PUBLIC_STRIPE_PRICE_ID olarak kaydedildi.)
ÃœrÃ¼n ID: prod_RtLFieRdfw3Vrc 


3. Backend YapÄ±landÄ±rmasÄ±
3.1. API Route'larÄ± OluÅŸturma
/api/checkout/session: Ã–deme oturumu baÅŸlatmak iÃ§in
/api/subscription/status: Abonelik durumunu kontrol etmek iÃ§in
/api/webhooks/stripe: Stripe webhook'larÄ±nÄ± iÅŸlemek iÃ§in

3.2. Webhook AyarlarÄ±
Stripe CLI ya da mcp kullanarak test webhook'larÄ± iÃ§in gereken gÃ¼venlik ayarlarÄ±nÄ± yapÄ±n
Stripe Dashboard'da webhook endpoint'inizi kaydedin: https://www.bakiye360.com/api/webhooks/stripe
checkout.session.completed, customer.subscription.updated, customer.subscription.deleted event'lerini dinleyin

3.3. KullanÄ±cÄ± Yetkilendirme Sistemi
Middleware kullanarak premium iÃ§eriÄŸe eriÅŸimi kontrol edin
KullanÄ±cÄ± rollerine gÃ¶re farklÄ± iÃ§erikleri gÃ¶sterme/gizleme mantÄ±ÄŸÄ±nÄ± oluÅŸturun
4. Frontend GeliÅŸtirmesi
4.1. Premium Abonelik SayfasÄ± OluÅŸturma
/pricing veya /premium gibi bir rota oluÅŸturun
Ãœcretsiz vs. premium Ã¶zellikleri karÅŸÄ±laÅŸtÄ±ran bir tablo ekleyin
"Premium'a GeÃ§" butonlarÄ± yerleÅŸtirin
4.2. Ã–deme SayfasÄ±
Stripe Checkout entegrasyonu iÃ§in frontend bileÅŸenleri oluÅŸturun
KullanÄ±cÄ± dostu Ã¶deme akÄ±ÅŸÄ± tasarlayÄ±n
4.3. Hesap YÃ¶netimi
/dashboard/account sayfasÄ±nda abonelik bilgilerini gÃ¶sterin
AboneliÄŸi yÃ¶netme (iptal etme, yÃ¼kseltme) seÃ§enekleri ekleyin
Fatura geÃ§miÅŸi ve Ã¶deme metodlarÄ± yÃ¶netimi
4.4. Premium Ä°Ã§erik UI GÃ¶stergeleri
Premium Ã¶zellikleri vurgulayan UI elementleri ekleyin
Premium olmayan kullanÄ±cÄ±lara "Premium'a geÃ§in" mesajlarÄ± gÃ¶sterin


5.2. Row Level Security (RLS) PolitikalarÄ±
Premium iÃ§eriÄŸe eriÅŸimi kÄ±sÄ±tlayacak gÃ¼venlik politikalarÄ± ekleyin
KullanÄ±cÄ±larÄ±n sadece kendi abonelik bilgilerine eriÅŸmesini saÄŸlayÄ±n


6. Test ve Kontrol
6.1. Test OrtamÄ±nda Ã–deme AkÄ±ÅŸÄ± Testi
Stripe test kartlarÄ±yla Ã¶deme iÅŸlemini test edin
Webhook'larÄ±n doÄŸru Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrulayÄ±n
Abonelik yaÅŸam dÃ¶ngÃ¼sÃ¼nÃ¼ test edin (oluÅŸturma, iptal etme, yenileme)
6.2. Premium Ä°Ã§erik EriÅŸim Testleri
Premium ve Ã¼cretsiz kullanÄ±cÄ±lar iÃ§in doÄŸru iÃ§eriklerin gÃ¶sterildiÄŸini kontrol edin
Edge case'leri test edin (Ã¶rn: abonelik sÃ¼resi dolan kullanÄ±cÄ±lar)
7. CanlÄ±ya Alma
7.1. Stripe CanlÄ± API AnahtarlarÄ±na GeÃ§iÅŸ
Test modundan canlÄ± moda geÃ§in
CanlÄ± ortam API anahtarlarÄ±nÄ± .env dosyasÄ±na ekleyin

7.2. Son Kontroller
GerÃ§ek Ã¶deme testleri yapÄ±n
KullanÄ±cÄ± deneyimini gÃ¶zden geÃ§irin
